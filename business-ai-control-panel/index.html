<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Business AI Control Panel - Fearless AI for Small Business</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
    <div id="root"></div>
    
    <script type="text/babel">
        const { useState } = React;

        const BusinessAIControlPanel = () => {
          const [formData, setFormData] = useState({
            query: '',
            industry: '',
            goal: '',
            constraints: '',
            outputFormat: 'paragraph'
          });
          
          const [reasoningLevel, setReasoningLevel] = useState('auto');
          const [isProcessing, setIsProcessing] = useState(false);
          const [result, setResult] = useState(null);
          const [qualityScore, setQualityScore] = useState(null);
          const [showExamples, setShowExamples] = useState(false);

          const examplePrompts = [
            {
              title: "Social Media Strategy",
              query: "How can I create a consistent social media presence without spending hours each day?",
              industry: "Real Estate",
              goal: "Increase brand visibility and generate leads",
              constraints: "Limited to 30 minutes per day, small budget",
              outputFormat: "steps"
            },
            {
              title: "Customer Retention",
              query: "What strategies can I implement to reduce customer churn and increase repeat purchases?",
              industry: "E-commerce",
              goal: "Improve customer lifetime value by 25%",
              constraints: "Need to implement within 60 days, $2000 budget",
              outputFormat: "paragraph"
            }
          ];

          const loadExample = (example) => {
            setFormData({
              query: example.query,
              industry: example.industry,
              goal: example.goal,
              constraints: example.constraints,
              outputFormat: example.outputFormat
            });
            setShowExamples(false);
          };

          const handleInputChange = (e) => {
            setFormData({
              ...formData,
              [e.target.name]: e.target.value
            });
          };

          const detectComplexity = (query, goal) => {
            const complexKeywords = ['strategy', 'analyze', 'develop', 'plan', 'forecast', 'optimize', 'compare', 'evaluate'];
            const simpleKeywords = ['write', 'draft', 'create', 'list', 'summarize'];
            
            const text = (query + ' ' + goal).toLowerCase();
            const hasComplex = complexKeywords.some(word => text.includes(word));
            const hasSimple = simpleKeywords.some(word => text.includes(word));
            
            if (hasComplex && !hasSimple) return 'complex';
            if (hasSimple && !hasComplex) return 'basic';
            return 'moderate';
          };

          const buildPrompt = () => {
            const level = reasoningLevel === 'auto' ? detectComplexity(formData.query, formData.goal) : reasoningLevel;
            
            let systemPrompt = `You are a business consultant AI. `;
            
            if (level === 'basic') {
              systemPrompt += `Provide quick, practical responses. Be concise and actionable.`;
            } else if (level === 'moderate') {
              systemPrompt += `Think through the problem carefully. Consider multiple angles but stay focused.`;
            } else {
              systemPrompt += `Use extended thinking for this complex business challenge. Consider all implications, alternatives, and long-term consequences.`;
            }

            const userPrompt = `
Business Question/Challenge: ${formData.query}

${formData.industry ? `Industry: ${formData.industry}` : ''}
${formData.goal ? `Goal: ${formData.goal}` : ''}
${formData.constraints ? `Constraints: ${formData.constraints}` : ''}

Preferred output format: ${formData.outputFormat}

Please provide a response that is:
1. Accurate and factually sound
2. Directly useful for the stated business goal
3. Concise without unnecessary wordiness
4. Addresses any mentioned constraints
5. Actionable with clear next steps

After your response, rate it on these criteria (1-5 scale each):
- Accuracy
- Usefulness
- Conciseness
- Constraint adherence
- Actionability
`;

            return { systemPrompt, userPrompt, level };
          };

          const validateResponse = (response) => {
            const accuracyMatch = response.match(/Accuracy[:\s]+(\d)/i);
            const usefulnessMatch = response.match(/Usefulness[:\s]+(\d)/i);
            const concisenessMatch = response.match(/Conciseness[:\s]+(\d)/i);
            const constraintMatch = response.match(/Constraint[s]?[:\s]+(\d)/i);
            const actionabilityMatch = response.match(/Actionability[:\s]+(\d)/i);

            if (accuracyMatch && usefulnessMatch) {
              return {
                accuracy: parseInt(accuracyMatch[1]),
                usefulness: parseInt(usefulnessMatch[1]),
                conciseness: parseInt(concisenessMatch?.[1] || 4),
                constraints: parseInt(constraintMatch?.[1] || 4),
                actionability: parseInt(actionabilityMatch?.[1] || 4)
              };
            }

            const wordCount = response.split(/\s+/).length;
            return {
              accuracy: 4,
              usefulness: response.includes('consider') || response.includes('recommend') ? 5 : 4,
              conciseness: wordCount < 300 ? 5 : wordCount < 500 ? 4 : 3,
              constraints: formData.constraints ? 4 : 5,
              actionability: response.includes('step') || response.includes('action') ? 5 : 4
            };
          };

          const handleSubmit = async () => {
            if (!formData.query) {
              alert('Please enter your business question');
              return;
            }
            
            setIsProcessing(true);
            setResult(null);
            setQualityScore(null);

            const { systemPrompt, userPrompt, level } = buildPrompt();

            try {
              const response = await fetch('/.netlify/functions/generate-response', {
                method: 'POST',
                headers: {
                  'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                  systemPrompt,
                  userPrompt,
                  level
                })
              });

              const data = await response.json();
              
              if (data.error) {
                setResult('Error: ' + (data.error.message || JSON.stringify(data.error)));
                return;
              }
              
              const aiResponse = data.content[0].text;
              
              const scores = validateResponse(aiResponse);
              const avgScore = (scores.accuracy + scores.usefulness + scores.conciseness + scores.constraints + scores.actionability) / 5;
              
              setResult(aiResponse);
              setQualityScore({ ...scores, average: avgScore });
              
            } catch (error) {
              setResult('Error processing request: ' + error.message + '. Please make sure the Netlify function is deployed and the API key is configured.');
              console.error('Error:', error);
            } finally {
              setIsProcessing(false);
            }
          };

          const exportAsText = () => {
            const content = `
BUSINESS AI CONTROL PANEL - RESULTS
Generated: ${new Date().toLocaleString()}

QUESTION: ${formData.query}
${formData.industry ? `INDUSTRY: ${formData.industry}` : ''}
${formData.goal ? `GOAL: ${formData.goal}` : ''}
${formData.constraints ? `CONSTRAINTS: ${formData.constraints}` : ''}
REASONING LEVEL: ${getReasoningLabel()}

QUALITY SCORES:
- Accuracy: ${qualityScore.accuracy}/5
- Usefulness: ${qualityScore.usefulness}/5
- Conciseness: ${qualityScore.conciseness}/5
- Constraints: ${qualityScore.constraints}/5
- Actionability: ${qualityScore.actionability}/5
- Overall: ${qualityScore.average.toFixed(1)}/5

RESPONSE:
${result}

---
Powered by Fearless AI for Small Business
Learn more: https://theamigaagency.com
        `;

            const blob = new Blob([content], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `business-ai-results-${Date.now()}.txt`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
          };

          const exportAsPDF = () => {
            window.print();
          };

          const getReasoningLabel = () => {
            if (reasoningLevel === 'auto') {
              const detected = detectComplexity(formData.query, formData.goal);
              return `Auto (Detecting: ${detected.charAt(0).toUpperCase() + detected.slice(1)})`;
            }
            return reasoningLevel.charAt(0).toUpperCase() + reasoningLevel.slice(1);
          };

          return (
            <div className="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 p-6">
              <div className="max-w-4xl mx-auto">

                <div className="bg-white rounded-2xl shadow-xl p-8 mb-6">
                  <div className="flex items-center justify-between mb-6">
                    <div className="flex items-center gap-3">
                      <div className="text-4xl">ðŸ§ </div>
                      <div>
                        <h1 className="text-3xl font-bold text-gray-900">Business AI Control Panel</h1>
                        <p className="text-gray-600">Smart reasoning for smarter business decisions</p>
                      </div>
                    </div>
                    <button
                      onClick={() => setShowExamples(!showExamples)}
                      className="flex items-center gap-2 px-4 py-2 bg-yellow-100 text-yellow-800 rounded-lg hover:bg-yellow-200 transition-colors"
                    >
                      ðŸ’¡ Examples
                    </button>
                  </div>

                  {showExamples && (
                    <div className="mb-6 p-4 bg-yellow-50 rounded-lg border border-yellow-200">
                      <h3 className="font-semibold text-gray-900 mb-3">Try These Examples:</h3>
                      <div className="space-y-2">
                        {examplePrompts.map((example, idx) => (
                          <button
                            key={idx}
                            onClick={() => loadExample(example)}
                            className="w-full text-left p-3 bg-white rounded-lg hover:bg-yellow-100 transition-colors"
                          >
                            <p className="font-semibold text-gray-900">{example.title}</p>
                            <p className="text-sm text-gray-600 mt-1">{example.query}</p>
                          </button>
                        ))}
                      </div>
                    </div>
                  )}

                  <div className="space-y-6">
                    <div>
                      <label className="block text-sm font-semibold text-gray-700 mb-2">
                        What's your business question or challenge?
                      </label>
                      <textarea
                        name="query"
                        value={formData.query}
                        onChange={handleInputChange}
                        rows="4"
                        className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent"
                        placeholder="e.g., How can I improve customer retention for my subscription business?"
                      />
                    </div>

                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                      <div>
                        <label className="block text-sm font-semibold text-gray-700 mb-2">
                          Industry/Business Type
                        </label>
                        <input
                          type="text"
                          name="industry"
                          value={formData.industry}
                          onChange={handleInputChange}
                          className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent"
                          placeholder="e.g., Real estate, E-commerce"
                        />
                      </div>

                      <div>
                        <label className="block text-sm font-semibold text-gray-700 mb-2">
                          What are you trying to accomplish?
                        </label>
                        <input
                          type="text"
                          name="goal"
                          value={formData.goal}
                          onChange={handleInputChange}
                          className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent"
                          placeholder="e.g., Increase revenue, Save time"
                        />
                      </div>
                    </div>

                    <div>
                      <label className="block text-sm font-semibold text-gray-700 mb-2">
                        Any constraints? (budget, time, resources)
                      </label>
                      <input
                        type="text"
                        name="constraints"
                        value={formData.constraints}
                        onChange={handleInputChange}
                        className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent"
                        placeholder="e.g., Limited to $500/month, Need results in 30 days"
                      />
                    </div>

                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                      <div>
                        <label className="block text-sm font-semibold text-gray-700 mb-2">
                          âš¡ Reasoning Level
                        </label>
                        <select
                          value={reasoningLevel}
                          onChange={(e) => setReasoningLevel(e.target.value)}
                          className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent"
                        >
                          <option value="auto">Auto-Detect</option>
                          <option value="basic">Basic (Quick Tasks)</option>
                          <option value="moderate">Moderate (Strategy)</option>
                          <option value="complex">Complex (Deep Analysis)</option>
                        </select>
                        <p className="text-xs text-gray-500 mt-1">Current: {getReasoningLabel()}</p>
                      </div>

                      <div>
                        <label className="block text-sm font-semibold text-gray-700 mb-2">
                          Output Format
                        </label>
                        <select
                          name="outputFormat"
                          value={formData.outputFormat}
                          onChange={handleInputChange}
                          className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent"
                        >
                          <option value="paragraph">Paragraphs</option>
                          <option value="bullets">Bullet Points</option>
                          <option value="steps">Step-by-Step</option>
                          <option value="executive">Executive Summary</option>
                        </select>
                      </div>
                    </div>

                    <button
                      onClick={handleSubmit}
                      disabled={isProcessing || !formData.query}
                      className="w-full bg-indigo-600 text-white py-4 rounded-lg font-semibold hover:bg-indigo-700 disabled:bg-gray-400 disabled:cursor-not-allowed transition-colors flex items-center justify-center gap-2"
                    >
                      {isProcessing ? (
                        <>
                          <div className="animate-spin rounded-full h-5 w-5 border-b-2 border-white"></div>
                          Processing with {getReasoningLabel()} reasoning...
                        </>
                      ) : (
                        <>
                          ðŸ§  Generate Smart Response
                        </>
                      )}
                    </button>
                  </div>
                </div>

                {qualityScore && (
                  <div className="bg-white rounded-2xl shadow-xl p-8 mb-6">
                    <div className="flex items-center justify-between mb-4">
                      <h2 className="text-xl font-bold text-gray-900 flex items-center gap-2">
                        âœ… Quality Validation
                      </h2>
                      <div className="flex gap-2">
                        <button
                          onClick={exportAsText}
                          className="flex items-center gap-2 px-4 py-2 bg-indigo-100 text-indigo-700 rounded-lg hover:bg-indigo-200 transition-colors"
                        >
                          ðŸ“„ Export TXT
                        </button>
                        <button
                          onClick={exportAsPDF}
                          className="flex items-center gap-2 px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors"
                        >
                          ðŸ“¥ Print/PDF
                        </button>
                      </div>
                    </div>
                    <div className="grid grid-cols-2 md:grid-cols-3 gap-4">
                      {Object.entries(qualityScore).map(([key, value]) => {
                        if (key === 'average') return null;
                        const label = key.charAt(0).toUpperCase() + key.slice(1);
                        const color = value >= 4 ? 'text-green-600' : value >= 3 ? 'text-yellow-600' : 'text-red-600';
                        return (
                          <div key={key} className="bg-gray-50 p-4 rounded-lg">
                            <p className="text-sm text-gray-600 mb-1">{label}</p>
                            <p className={`text-2xl font-bold ${color}`}>{value}/5</p>
                          </div>
                        );
                      })}
                      <div className="bg-indigo-50 p-4 rounded-lg md:col-span-3">
                        <p className="text-sm text-gray-600 mb-1">Overall Quality Score</p>
                        <p className="text-2xl font-bold text-indigo-600">{qualityScore.average.toFixed(1)}/5</p>
                      </div>
                    </div>
                  </div>
                )}

                {result && (
                  <div className="bg-white rounded-2xl shadow-xl p-8">
                    <h2 className="text-xl font-bold text-gray-900 mb-4">Your Business Solution</h2>
                    <div className="prose prose-indigo max-w-none">
                      <div className="whitespace-pre-wrap text-gray-700 leading-relaxed">
                        {result}
                      </div>
                    </div>
                  </div>
                )}
              </div>
            </div>
          );
        };

        ReactDOM.render(<BusinessAIControlPanel />, document.getElementById('root'));
    </script>
</body>
</html>